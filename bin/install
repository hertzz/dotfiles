#!/usr/bin/env bash
#
# osx-soe-playbook
# https://github.com/hertzz/osx-soe-playbook
#

LOCAL_HOST="127.0.0.1"
ANSIBLE_ETC_DIR="/etc/ansible"

if [[ $EUID -ne 0 ]]; then
   echo "This script must be run as root (maybe try again using sudo)." && exit 1
fi

if ! which pip &>/dev/null; then
  easy_install pip
  if [ $? -eq 0 ]; then
    echo "--> Installed pip."
  else
    echo "--> Failed to install pip." && exit 1
  fi
else
  echo "--> pip is already installed."
fi

if ! which ansible &>/dev/null; then
  pip install ansible
  if [ $? -eq 0 ]; then
    echo "--> Installed ansible tools."
  else
    echo "--> Failed to install ansible tools." && exit 1
  fi
else
  echo "--> Ansible tools are already installed."
fi

# Create ansible hosts file
if [ ! -d $ANSIBLE_ETC_DIR ]; then
  if mkdir -p $ANSIBLE_ETC_DIR; then
    echo "--> Created ${ANSIBLE_ETC_DIR} directory"
  else
    echo "--> Failed to create ${ANSIBLE_ETC_DIR} directory." && exit 1
  fi
else
  echo "--> Ansible HOME already setup."
fi

if ! grep "127.0.0.1" $ANSIBLE_ETC_DIR/hosts &>/dev/null; then
  echo "${LOCAL_HOST}" > /etc/ansible/hosts
  if [ $? -eq 0 ]; then
    echo "--> Created localhost in ansible hosts"
  else
    echo "--> Failed to create localhost in ansible hosts" && exit 1
  fi
else
  echo "--> Ansible hosts already setup."
fi

echo "--> Done."
